name: Flutter CI/CD

on:
  push:
    branches:
      - main    # åªåœ¨ä¸»åˆ†æ”¯æ¨é€æ—¶è§¦å‘
  pull_request:
    branches:
      - main    # åœ¨ä¸»åˆ†æ”¯çš„ Pull Request æ—¶è§¦å‘

permissions:
  contents: write  # ğŸ‘ˆ æ·»åŠ è¿™ä¸ªï¼å…è®¸å‘å¸ƒ Release
  
jobs:
  build:
    runs-on: macos-latest   # ä½¿ç”¨æœ€æ–°çš„ macOS ç¯å¢ƒ
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3   # æ‹‰å–ä»£ç 

      - name: Set up Flutter
        uses: subosito/flutter-action@v2  # è®¾ç½® Flutter ç¯å¢ƒ
        with:
          flutter-version: '3.24.3'  # æŒ‡å®š Flutter ç‰ˆæœ¬ï¼ˆæ ¹æ®éœ€è¦ä¿®æ”¹ï¼‰

      - name: Install dependencies
        run: |
          flutter pub get  # å®‰è£…ä¾èµ–

      - name: Build iOS app
        run: |
          flutter build ios --flavor=Prod --dart-define=ENV=dev --release --no-codesign   # æ‰“åŒ… iOS åº”ç”¨ï¼Œä¸è¿›è¡Œç­¾å

      - name: Upload IPA to GitHub releases
        uses: ncipollo/release-action@v1
        with:
          tag: ${{ github.ref_name }}
          files: build/ios/iphoneos/MultiEnv Prod.app   # ä¸Šä¼ æ‰“åŒ…åçš„ IPA æ–‡ä»¶
